doctype html
html(lang='en')
  head
    title ELAB HKBK
    include navbar
    script(src='/ace-builds/src-min/ace.js' charset='utf-8')
    script(src='/ace-builds/src-min/ext-language_tools.js')
    script(src='/assets/js/jquery.min.js')
    link(rel='stylesheet' href='//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css')

    
    style(type='text/css').
      #editor {
      position: relative;
      top: 0;
      right: 0;
      bottom: 0;
      left: 20px;
      height: 500px; 
      margin:10px;
      }
      .card {
      width: 650px;
      box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
      text-align: left;
      left: 20px;
      padding: 10px;
      margin: 20px;
      position: relative;
      
      }

      
      .option-disp {
        position:relative;
        width: 150px;
        left:20px;
      }

      button a:link,a:visited {
        color: black;
        text-align: center;
        text-decoration: none;
        display: inline-block;
      }
      
      html {
        scroll-behavior: smooth;
      }
      textarea {
      border: none;
      background-color: transparent;
      resize: none;
      outline: none;
      }

      .theme,.font_size{
        margin-left:50px;
      }

      .nav-tabs .nav-link.active.red-cross{
        font-weight:bold;
        color:red;
      }
      .red-cross,.red-cross-t{
        font-weight:bold;
        color:red;
      }
      .red-cross:hover{
          color:white;
          background-color:red;
      }
      .green-tick:hover{
          color:white;
          background-color:green;
      }
      
      .nav-tabs .nav-link.active.green-tick{
        font-weight:bold;
        color:green;        
      }
      .green-tick,.green-tick-t{
        font-weight:bold;
        color:green;        
      }
      /*.nav-tabs .nav-item.show .nav-link,.nav-tabs .nav-link.active{  
      
      background-color:#fff;
      border-color:#dee2e6 #dee2e6 #fff;
      }*/
      
      
  body
    .card#card
      p #{question.statement}
      - if(question.constraints) 
          strong Constraints
          p #{question.constraints}
          |
      strong Input Format
      p #{question.input_format}
      |
      strong Output Format
      p #{question.output_format}
      |
      each i,j in question.sample_cases
        strong Sample Input #{j+1}
        p(class="sa" id="sam_i"+j) #{i.input}
        strong Sample Output #{j+1}
        p(id="sam_o"+j) #{i.output}
   
        
    .card(style="width:90%; display:inline-block;")
      label(for="lang") Language
      select.option-disp#lang(onchange='language()')
        option(value='python71') Python
        option(value='java62') Java
        option(value='javascript63') Javascript
        option(value='c_cpp50') C
        option(value='c_cpp54') C++
        option(value='csharp51') C#
      label.theme(for="theme") Theme
      select.option-disp#theme(onchange='theme()')
        option(value='monokai') Monokai
        option(value='chaos') Chaos
        option(value='dracula') Dracula
        option(value='cobalt') Cobalt
        option(value='gob') Green on Black
        option(value='xcode') XCode
        option(value='chrome') Chrome
        option(value='github') Github
      label.font_size Font Size
      select.option-disp#fontsize(onchange='fontSize()')
        option(value='18') 18
        option(value='24') 24
        option(value='30') 30
        option(value='36') 36
      
      div#editor
      button#button.btn(value='Run', onclick='readText()', style='margin-right:20px;border-color:black;width:100px;position:relative;left:20px;') 
        a(href='#opbox') Run
      button#button_submit.btn(value='Submit', onclick='submission()', style='border-color:black;width:100px;position:relative;left:20px;') 
        a(href='#opbox') Submit
    
    #opbox.output_box(style="width:50%; display:inline-block;")


    script.
      let editor = ace.edit("editor");
      ace.require("ace/ext/language_tools");
      editor.setTheme("ace/theme/monokai");
      editor.session.setMode("ace/mode/python");
      editor.getSession().setUseWrapMode(true);

      editor.setOptions({
      enableBasicAutocompletion: true,
      enableSnippets: true,
      enableLiveAutocompletion: true,
      showPrintMargin: false,
      fontSize:18,
      indentedSoftWrap: false

      });
      function theme(){
      let t = document.getElementById("theme").value;
      editor.setTheme("ace/theme/"+t);
      }
      function fontSize() {
        let s = document.getElementById("fontsize").value;
        editor.setOption("fontSize",parseInt(s));
      }
      function language(){
      let l = document.getElementById("lang").value;
      l=l.slice(0,-2);
      editor.session.setMode("ace/mode/"+l);
      }
      
      function readText () {
      let l = document.getElementById("lang").value;
      l=l.slice(-2);
      $(document).ready(function(){
      $.post("/api",
      {
      source:editor.getValue(),
      language: l,
      qid: window.location.pathname
      },
      function(data,status){
      for(let i=0;i<data.length;i++)
      {
      if(data[i].id==3){
        $('#color'+(i+1)+'').addClass('green-tick');
        $('#icon'+(i+1)+'').addClass('fa fa-check');
      }
      else{
        $('#color'+(i+1)+'').addClass('red-cross');
        $('#icon'+(i+1)+'').addClass('fa fa-close');
      }
      }
      for(let i=0;i<$('#card .sa').length;i++){
      document.getElementById("output"+(i+1)+"").value = data[i].output;
      document.getElementById("input"+(i+1)+"").value = document.getElementById("sam_i"+i+"").innerHTML;
      document.getElementById("expectedOutput"+(i+1)+"").value = document.getElementById("sam_o"+i+"").innerHTML;
      }
      });
      window.location.href="#opbox";
      });
      }

      function submission(){
        let l = document.getElementById("lang").value;
        l=l.slice(-2);
        $(document).ready(function (){
        $.post(window.location.pathname,
        {
        source:editor.getValue(),
        language: l
        },
        function(data,status){
          $(".green-tick-t").remove();
            $(".red-cross-t").remove();
          for(let i=0;i<data.length;i++){
            
            let node =document.createElement("P");
            node.setAttribute("id","t"+(i+1)+"");
            let textnode=document.createTextNode("Testcase "+(i+1)+""+" ");
            let n1=document.createElement("I");

          if(data[i].id==3){
            node.setAttribute("class","green-tick-t");
            n1.setAttribute("class","fa fa-check");
          }
          else{
            node.setAttribute("class","red-cross-t");
            n1.setAttribute("class","fa fa-close");
          }
          
          node.appendChild(textnode);
          node.appendChild(n1);
          n1=document.createTextNode(" "+data[i].description);
          node.appendChild(n1);
          document.getElementById("TestCases").appendChild(node);
          }
          //-  alert(data);
        });
        });
      }

      $(document).ready(function() {
        var count=0,count1=0;
        $('#button').click(function()
        { 
          $(".SUBMIT_BOX").remove();
          count1=0;
          if(count==0){
            count=count+1;
            //$('#opbox').append('<div name="out" id="out" style="width: 650px;height:600px;box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);text-align: left;left: 20px;padding: 10px;margin: 20px;position: relative;"><label><u><b>Input</b></u></label><textarea id="input" readonly="readonly" style="width:100%;border:none;"></textarea><label><u><b>Output</b></u></label><textarea id="output" readonly="readonly" style="width:100%;border:none;"></textarea><label><u><b>Expected Output</b></u></label><textarea id="expectedOutput" readonly="readonly" style="width:100%;border:none;"></textarea></div>');
            $('#opbox').append('<div name="out" id="out" class="container mt-3 OUTPUT" style="width: 650px;height:600px;box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);text-align: left;left: 20px;padding: 10px;margin: 20px;position: relative;"><ul class="nav nav-tabs" id="Output"></ul><div class="tab-content" id="tab-content"></div></div>');
            for(var i=1;i<=$('#card .sa').length;i++){
              if(i==1){
              $('#Output').append('<li class="nav-item"><a class="nav-link active" id="color'+i+'" data-toggle="tab" href="#tab'+i+'">Sample '+i+'  <i id="icon'+i+'"></i></a></li>');
              $('#tab-content').append('<div id="tab'+i+'" class="container tab-pane active"><br><label><u><b>Input</b></u></label><textarea id="input'+i+'" readonly="readonly" style="width:100%;border:none;"></textarea><label><u><b>Output</b></u></label><textarea id="output'+i+'" readonly="readonly" style="width:100%;border:none;"></textarea><label><u><b>Expected Output</b></u></label><textarea id="expectedOutput'+i+'" readonly="readonly" style="width:100%;border:none;"></textarea></div>');
              }else{
              $('#Output').append('<li class="nav-item"><a class="nav-link" id="color'+i+'" data-toggle="tab" href="#tab'+i+'">Sample '+i+'  <i id="icon'+i+'"></i></a></li>');                
              $('#tab-content').append('<div id="tab'+i+'" class="container tab-pane fade"><br><label><u><b>Input</b></u></label><textarea id="input'+i+'" readonly="readonly" style="width:100%;border:none;"></textarea><label><u><b>Output</b></u></label><textarea id="output'+i+'" readonly="readonly" style="width:100%;border:none;"></textarea><label><u><b>Expected Output</b></u></label><textarea id="expectedOutput'+i+'" readonly="readonly" style="width:100%;border:none;"></textarea></div>');
              }
            } 

          }
        });
        $('#button_submit').click(function(){
        
          $(".OUTPUT").remove();
          count=0;
        
        if(count1==0){
        $('#opbox').append('<div name="out" id="out" class="container mt-3 SUBMIT_BOX" style="width: 650px;box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);text-align: left;left: 20px;padding: 10px;margin: 20px;position: relative;"><div id="TestCases"></div></div>');
        count1=count1+1;
        
        }
        }
        );
        });
