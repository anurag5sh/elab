include nav

head
    link(rel="stylesheet", href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css")
    script(src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js")
    script(src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js")



body
    h2 Submissions

    .container.main-section
        .row
            .col-lg-12
                table#submission.table.table-hover
                    thead
                        tr
                            th No.
                            th USN / ID
                            th Name
                            th Question Name
                            th Source Code
                            th Time (HH:MM:SS:MS)
                            th Points
                            th Status
                    tbody

    .modal.fade#source(tabindex ="-1" role="dialog" )
        .modal-dialog.modal-lg
            .modal-content
                .modal-header
                    h4.modal-title 
                .modal-body#sourceBody
                    textarea#sourceArea()
                .modal-footer
                    button.btn.btn-secondary(type='button' data-dismiss='modal') Close

    script.
        $.get('/contest/submissions/#{contest.url}',function(data,status){
                    const submissions = $('#submission').DataTable( {
                        "data":data,
                        "columns": [
                            { "data": null },
                            { "data": "usn" },
                            { "data": "name" },
                            { "data": "qname" },
                            { "data": "code" },
                            { "data": "time" },
                            { "data": "points" },
                            { "data": "status" },
                        ],
                        "order": [[ 5, 'asc' ]],
                        "columnDefs": [ {"searchable": false,"orderable": false,"targets": 0},
                                        { "width": "1%", "targets": 0 },
                                        {"searchable": false,"orderable": false,"targets": 4},
                                        {"searchable": false,"targets": 3},
                                        {"searchable": false,"targets": 5},
                                        {"searchable": false,"targets": 6},
                                        {"searchable": false,"targets": 7} ]
                    } );
                     submissions.on( 'order.dt search.dt', function () {
                        submissions.column(0, {search:'applied', order:'applied'}).nodes().each( function (cell, i) {
                            cell.innerHTML = i+1;
                        } );
                    } ).draw();
                }).fail((err)=>{
                    toastr.error(err.responseText);
                });

        
        $("#source").on('show.bs.modal',function (e){
            $.get('/contest/source/#{contest.url}/'+$(e.relatedTarget).data('usn')+'/'+$(e.relatedTarget).data('qid'),function(data,status){
                $("#sourceArea").val(data);
                $("#sourceArea").height($("#sourceArea")[0].scrollHeight);
            });

        });